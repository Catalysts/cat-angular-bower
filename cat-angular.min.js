/*
 * Copyright 2014 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(t){"use strict";t.cat={},angular.module("cat.directives",["ui.select2"]),angular.module("cat.controller",[]),angular.module("cat.template",[]),angular.module("cat.service.api",[]),angular.module("cat.service",["angularSpinner","ngRoute","cat.service.api"]),angular.module("cat",["cat.service","cat.template","cat.directives","cat.controller"])}(window,document),function(t,e,n){"use strict";t.cat=t.cat||{},t.cat.FacetTerm=function(t){t===n&&(t={}),this.id=t.id,this.name=t.name,this.count=t.count},t.cat.Facet=function(e){e===n&&(e={}),this.name=e.name,this.terms=_.map(e.facets,function(e){return new t.cat.FacetTerm(e)})}}(window,document),function(t,e,n){"use strict";t.cat=t.cat||{},t.cat.SearchRequest=function(t){var e,i={page:1,size:100},r={},a={};t&&!_.isEmpty(t)&&(i.page=t.page||i.page,i.size=t.size||i.size,r.property=t.sort||r.property,r.isDesc=t.rev||r.isDesc,_.forEach(_.keys(t),function(e){e.indexOf("search.")>-1&&e.length>7&&(a[e.substring(7)]=t[e])}));var o=function(){return r.property?"sort="+r.property+":"+(r.isDesc===!0||"true"===r.isDesc?"desc":"asc"):""},s=function(){return"page="+(i.page?Math.max(0,i.page-1):0)+"&size="+i.size||100},c=function(t,e){return t?e?t+"&"+e:t:e},u=function(){return a&&!_.isEmpty(a)?$.param(a):""},l=function(){return _([s(),o(),u()]).reduce(c)};this.pagination=function(t){return t===n?i:i=t},this.sort=function(t){return t===n?r:r=t},this.search=function(t){return t===n?a:a=t},this.urlEncoded=function(){return e=l()},this.isDirty=function(){return e!==l()},this.setSearch=function(t){var e={};e.page=i.page,e.size=i.size,r.property&&(e.sort=r.property,e.rev=r.isDesc||!1),_.forEach(_.keys(a),function(t){e["search."+t]=a[t]}),t.search(e)}}}(window,document),function(t,e,n){"use strict";function i(e,i,r,a,o,s,c,u,l){e.detail=l.detail,e.editDetail=n,e.$fieldErrors={};var d=l.endpoint,f=l.baseUrl,p=l.templateUrls,h=l.Model;e.uiStack=u.generateFromConfig(l),u.push({title:"new"===i.id?"New":""}),e.editTemplate=p.edit,_.isObject(p.view)?(e.mainViewTemplate=p.view.main,e.additionalViewTemplate=p.view.additional):e.mainViewTemplate=p.view,e.baseUrl=f,e.title=function(){var t=e.detail;return _.isUndefined(t)?"":t.breadcrumbTitle?t.breadcrumbTitle():t.name?t.name:t.id};var m=function(){u.replaceLast({title:e.title()})},g=function(){d.get(i.id).then(function(t){e.detail=t,m()})};e.reloadDetails=g,e.exists=!!i.id&&"new"!==i.id,e.add=function(){e.editDetail=new h,_.isFunction(e.editDetail.setParent)&&e.editDetail.setParent(l.parents[0])},e.edit=function(){e.editDetail=angular.copy(e.detail),_.isFunction(e.editDetail.setParent)&&e.editDetail.setParent(l.parents[0])},e.cancelEdit=function(){e.$broadcast("formReset"),e.exists?(e.editDetail=n,o.clearMessages(),e.$fieldErrors=n):a.history.back()},e.remove=function(){d.remove(e.detail.id).then(function(){if(_.isEmpty(e.uiStack))r.path(f);else{var n=e.uiStack[e.uiStack.length-1].url;r.path(n.substring(1,n.indexOf("?"))),r.search("tab",t.cat.util.pluralize(d.getEndpointName()))}})},e.save=function(){d.save(e.editDetail).then(function(t){o.clearMessages(),e.$fieldErrors=n,e.exists?(e.editDetail=n,e.detail=t,m()):(e.$broadcast("formReset"),r.path(f+"/"+t.id))},function(t){if(!t.data.fieldErrors)return void(e.$fieldErrors=n);var i={};_.forEach(t.data.fieldErrors,function(t){i[t.field]=i[t.field]||[],i[t.field].push(t.message)}),e.$fieldErrors=i,e.$broadcast("fieldErrors",i)})},e.exists?_.isUndefined(e.detail)?g():m():_.isUndefined(e.detail)?e.add():e.edit();try{s(l.controller,{$scope:e,detail:l.detail,parents:l.parents,config:l})}catch(v){c.info("Couldn't instantiate controller with name "+l.controller)}}angular.module("cat").controller("CatBaseDetailController",i)}(window,document),function(){"use strict";function t(t,e,n,i,r){i.set([{title:r.title}]),t.listData=r.listData,this.title=r.title,this.searchProps=r.searchProps,this.config=r,this.getUrlForId=function(t){return"#"+r.baseUrl+"/"+t},this.getUrlForNewPage=function(){return this.getUrlForId("new")};try{e(r.controller,{$scope:t,listData:r.listData,config:r})}catch(a){n.info("Couldn't instantiate controller with name "+r.controller)}}angular.module("cat").controller("CatBaseListController",t)}(window,document),function(){"use strict";angular.module("cat").directive("catAutofocus",function(t){return{restrict:"A",link:function(e,n){t(function(){_.isUndefined(n.data("select2"))?n[0].focus():n.select2("open")},100)}}})}(window,document),function(){"use strict";angular.module("cat").directive("catCheckbox",function(){return{replace:!0,restrict:"E",scope:{checked:"="},link:function(t,e){e.addClass(t.checked?"glyphicon glyphicon-check":"glyphicon glyphicon-unchecked")}}})}(window,document),function(t){"use strict";angular.module("cat").directive("catConfirmClick",function(){return{restrict:"A",link:function(e,n,i){var r=i.catConfirmClick||"Are you sure?",a=i.catOnConfirm;n.bind("click",function(){t.confirm(r)&&e.$eval(a)})}}})}(window,document),function(t,e,n){"use strict";angular.module("cat").directive("catFacets",function(){function t(t){_.isUndefined(t.listData)&&(t.listData=t.$parent.listData)}function e(t){if(_.isUndefined(t.listData))throw new Error("listData was not defined and couldn't be found with default value");if(_.isUndefined(t.listData.facets))throw new Error("No facets are available within given listData")}return{replace:!0,restrict:"E",scope:{listData:"=?",names:"="},templateUrl:"template/cat-facets.tpl.html",link:function(n){t(n),e(n)},controller:function(t){function e(e){return t.listData.searchRequest.search(e)}t.isActive=function(t){return!e()[t.name]},t.showAll=function(t){var n=e();delete n[t.name],e(n)},t.facetName=function(e){return t.names!==n&&t.names[e.name]!==n?t.names[e.name]:e.name},t.setActive=function(t,n){t.activeTerm=n;var i=e();i[t.name]=n.id,e(i)}}}})}(window,document),function(){"use strict";angular.module("cat").directive("catFieldErrors",function(){return{replace:"true",restrict:"E",scope:{errors:"=",name:"@"},template:'<div class="label label-danger" ng-if="errors[name]"><ul><li ng-repeat="error in errors[name]">{{error}}</li></ul></div>'}})}(window,document),function(){"use strict";angular.module("cat").directive("input",function(){return{require:"ngModel",restrict:"E",link:function(t,e,n,i){t.$on("fieldErrors",function(t,e){if(e&&n.id){var r=!e[n.id];i.$setValidity(n.id,r)}})}}}).directive("catInputGroup",function(){return{restrict:"A",transclude:!0,scope:{errors:"=",label:"@",name:"@"},link:function(t,e){e.addClass("form-group")},templateUrl:"template/cat-input.tpl.html"}})}(window,document),function(){"use strict";angular.module("cat").directive("catLoadMore",function(){return{replace:!0,restrict:"A",link:function(t,e,n){var i=parseInt(n.catLoadMore);if(t.$parent.elementsCount=t.$parent.elementsCount||i,t.$parent.elements=t.$parent.elements||[],t.$parent.elements.push(e),t.$parent.elements.length>t.$parent.elementsCount&&e.addClass("hidden"),!e.parent().next().length&&t.$parent.elements.length>t.$parent.elementsCount){var r=$('<a href="#">Show more</a>');r.on({click:function(){return t.$parent.elementsCount+=i,t.$parent.elements.length<=t.$parent.elementsCount&&r.addClass("hidden"),t.$parent.elements.forEach(function(e,n){n<t.$parent.elementsCount&&e.removeClass("hidden")}),!1}}),e.parent().after(r)}}}})}(window,document),function(){"use strict";angular.module("cat").directive("catMainMenu",["$mainMenu","$rootScope",function(t,e){return{restrict:"E",scope:{},link:function(n){n.menus=t.getMenus(),n.isVisible=function(t){var e=!1;return t.isMenu()||t.isGroup()?(_.forEach(t.getEntries(),function(t){e=e||n.isVisible(t)}),t.isMenu()&&_.forEach(t.getGroups(),function(t){e=e||n.isVisible(t)}),e):n.isAllowed(t)},n.isAllowed=function(t){var n=t.getOptions().rights;if(n){if(_.isArray(n)){for(var i=!0,r=0;r<n.length;r++)i=i&&e.isAllowed(n[r]);return i}return e.isAllowed(n)}return!0}},templateUrl:"template/cat-main-menu.tpl.html"}}])}(window,document),function(){"use strict";angular.module("cat").directive("catPaginated",function(){return{replace:!0,restrict:"E",transclude:!0,scope:{listData:"=?",syncLocation:"=?"},templateUrl:"template/cat-paginated.tpl.html",link:function(t,e,n){n.searchProps&&(t.searchProps=_.filter(n.searchProps.split(","),function(t){return!!t}))},controller:function(t,e,n,i,r){function a(){t.syncLocation!==!1&&(c.setSearch(e),e.replace())}var o=null,s=500;if(_.isUndefined(t.listData)&&(t.listData=t.$parent.listData,_.isUndefined(t.listData)))throw new Error("listData was not defined and couldn't be found with default value");_.isUndefined(t.syncLocation)&&(t.syncLocation=_.isUndefined(t.$parent.detail)),t.listData.search=t.listData.search||t.listData.searchRequest.search()||{};var c=t.listData.searchRequest,u=function(e){i.cancel(o),o=i(function(){c.isDirty()&&n.load(t.listData.endpoint,c).then(function(e){_.assign(t.listData,e)})},e||0)};t.$watch("listData.sort",function(e){e&&(console.log("broadcasting sort changed: "+angular.toJson(e)),t.$parent.$broadcast("SortChanged",e))},!0),t.$on("SearchChanged",function(t,e,n){l(e,n)}),t.$watch("listData.pagination",function(){a(),u()},!0);var l=function(e,n){c.search(e),a(),t.listData.pagination.page=1,u(n)},d=function(t){var e=c.search();_.assign(e,t),r.$broadcast("SearchChanged",e,s)};t.$watch("listData.search",d,!0),this.sort=function(e){c.sort(e),a(),t.listData.pagination.page=1,u()},t.$on("SortChanged",function(t,e){this.sort(e)})}}})}(window,document),function(t){"use strict";function e(t,e){e.addClass("form-control")}function n(t,e,n,i){var a=i.getConfig(t.config,t.options);if(_.isUndefined(a))throw new Error('At least one of "config" or "options" has to be specified');var o,s,c=a.search||function(t,e){return{"search.name":t,page:e}},u=a.filter||function(){return!0};if(_.isArray(a.endpoint))o=function(t){return t.success({elements:a.endpoint})},s=0;else if(_.isFunction(a.endpoint))o=a.endpoint,s=500;else if(_.isObject(a.endpoint))o=r(a.endpoint,a.sort),s=500;else{if(!_.isString(a.endpoint))return e.error("The given endpoint has to be one of the following types: array, object, string or function - but was "+typeof a.endpoint),void(t.elements=[]);var l=n[a.endpoint];if(!l)return e.error('No api endpoint "'+a.endpoint+'" defined'),void(t.elements=[]);o=r(l,a.sort),s=500}t.selectOptions=_.assign({placeholder:" ",minimumInputLength:0,adaptDropdownCssClass:function(t){return _.contains(["ng-valid","ng-invalid","ng-pristine","ng-dirty"],t)?t:null},ajax:{data:c,quietMillis:s,transport:o,results:function(t,e){var n=(e*a.size||100)<t.totalCount;return{results:_.filter(t.elements,u),more:n}}},formatResult:function(t){return t.name},formatSelection:function(t){return t.name}},a["ui-select2"])}function i(){return{restrict:"EA",replace:!0,priority:1,scope:{options:"=?",id:"@",config:"@?"},link:e,controller:n,template:'<input type="text" ui-select2="selectOptions">'}}var r=function(e,n){return function(i){var r=new t.cat.SearchRequest(i.data);return r.sort(n||{property:"name",isDesc:!1}),e.list(r).then(i.success)}};angular.module("cat.directives").directive("catSelect",i)}(window,document),function(){"use strict";angular.module("cat").directive("catSortable",function(t){return{restrict:"AC",require:"^catPaginated",link:function(e,n,i,r){var a=n.text(),o=i.catSortable||a.toLowerCase().trim();e.sort=e.listData.searchRequest.sort(),e.catPaginatedController=r;var s="glyphicon-sort-by-attributes";i.sortMode&&("numeric"===i.sortMode?s="glyphicon-sort-by-order":"alphabet"===i.sortMode&&(s="glyphicon-sort-by-alphabet")),n.text(""),n.append(t('<a class="sort-link" href="" ng-click="toggleSort(\''+o+"')\">"+a+' <span class="glyphicon" ng-class="{\''+s+"': sort.property == '"+o+"' && !sort.isDesc, '"+s+"-alt': sort.property == '"+o+"' && sort.isDesc}\"></span></a>")(e))},controller:function(t){t.toggleSort=function(e){t.sort.property===e?t.sort.isDesc=!t.sort.isDesc:(t.sort.property=e,t.sort.isDesc=!1),t.catPaginatedController.sort(t.sort)},t.$on("SortChanged",function(e,n){t.sort=n})}}})}(window,document),function(t){"use strict";angular.module("cat").directive("form",["$timeout",function(e){return{restrict:"E",scope:!0,require:"form",link:function(n,i,r,a){var o=r.eocsWarnOnNavIfDirty||"You have unsaved changes. Leave the page?";e(function(){a.$setPristine(!0)},50),n.$on("formReset",function(){a.$setPristine(!0)}),n.$on("formDirty",function(){a.$setDirty(!0)}),n.$on("$locationChangeStart",function(e){a.$dirty&&(t.confirm(o)||e.preventDefault())}),$(t).on("beforeunload",function(){return a.$dirty?o:void 0}),n.$on("$destroy",function(){$(t).unbind("beforeunload")})}}}])}(window,document),function(){"use strict";angular.module("cat").directive("numbersOnly",function(){return{require:"ngModel",link:function(t,e,n,i){i.$parsers.push(function(t){if(!t)return"";var e="[^0-9]";n.hasOwnProperty("allowFraction")&&(e="[^0-9,.]");var r=t.replace(new RegExp(e,"g"),"");return r!==t&&(i.$setViewValue(r),i.$render()),r})}}})}(window,document),function(t,e,n){"use strict";angular.module("cat").filter("replaceText",function(){return function(t,e,i,r){return e===n&&(e="\n"),i===n&&(i="g"),r===n&&(r=", "),t?String(t).replace(new RegExp(e,i),r):t}})}(window,document),function(t){"use strict";function e(n,i,r){var a=this,o=i.name,s=n+(i.config.url||i.name),c=i.config.model,u=i.children,l=_.memoize(function(t){var n=s+"/"+t+"/",i={};return _.forEach(_.keys(u),function(o){i[o]=new e(n,u[o],r),i[o].parentEndpoint=a,i[o].parentId=t,i[o].parentInfo=function(){return a.info(t)}}),i}),d=function(t){var e=new c(t);return _.merge(e,l(e.id))},f=function(t){var e=l(t.id);return _.forEach(_.keys(e),function(e){delete t[e]}),t};this.res=function(t){return l(t)},this.getEndpointUrl=function(){return s},this.getEndpointName=function(){return o},this.list=function(e){var n=e&&e instanceof t.cat.SearchRequest?"?"+e.urlEncoded():"";return r.get(s+n).then(function(e){if(e.data.totalCount||0===e.data.totalCount){var n=[];return e.data.facets&&(n=_.map(e.data.facets,function(e){return new t.cat.Facet(e)})),{totalCount:e.data.totalCount,facets:n,elements:_.map(e.data.elements,function(t){return d(t)})}}return _.map(e.data,function(t){return d(t)})})},this.all=function(){return r.get(s+"/all").then(function(t){return _.map(t.data,function(t){return d(t)})})},this.get=function(t){return r.get(s+"/"+t).then(function(t){return d(t.data)})},this.info=function(t){return r.get(s+"/"+t+"?info").then(function(t){return t.data})},this.save=function(t){return t.id?r.put(s+"/"+t.id,f(t)).then(function(t){return d(t.data)}):r.post(s,f(t)).then(function(t){return d(t.data)})},this.remove=function(t){return r({method:"DELETE",url:s+"/"+t})}}function n(t,e){var i=this;if(this.config=e||{},this.children={},this.name=t,this.child=function(t,e){return _.isUndefined(e)||(this.children[t]=new n(t,e),this.children[t].parent=this),this.children[t]},!_.isUndefined(this.config.children)){var r=this.config.children;delete this.config.children,_.forEach(_.keys(r),function(t){i.child(t,r[t])})}}function i(){var t="/api/";this.endpoint=function(t,e){return _.isUndefined(e)||(r[t]=new n(t,e)),r[t]},this.$get=["$http",function(n){var i={};return _.forEach(_.keys(r),function(a){i[a]=new e(t,r[a],n)}),i}]}var r={};angular.module("cat.service.api").provider("catApiService",i),angular.module("cat.service.api").provider("$api",i)}(window,document),function(t){"use strict";function e(){function e(t){return t.charAt(0).toUpperCase()+t.substring(1)}function n(t,e){return _.initial(t.split("/"),e).join("/")}var i=[],r=this;this.clear=function(){i=[]},this.set=function(t){i=t},this.get=function(){return i},this.addFirst=function(t){i.unshift(t)},this.push=function(t){i.push(t)},this.pop=function(){i.pop()},this.length=function(){return i.length},this.replaceLast=function(t){i[i.length-1]=t},this.generateFromConfig=function(i){r.clear();var a=[];if(_.isUndefined(i.endpoint.parentEndpoint))r.push({title:e(t.cat.util.pluralize(i.endpoint.getEndpointName())),url:"#"+i.baseUrl});else for(var o=i.endpoint,s=o.parentEndpoint,c=i.baseUrl,u=0;!_.isUndefined(s);){var l=i.parents[u++];c=n(c,1);var d={url:"#"+c+"?tab="+t.cat.util.pluralize(o.getEndpointName()),title:l.name};a.unshift(d),r.addFirst(d),c=n(c,1);var f={title:e(t.cat.util.pluralize(s.getEndpointName())),url:"#"+c};r.addFirst(f),o=s,s=o.parentEndpoint}return a}}angular.module("cat.service").service("catBreadcrumbsService",e),angular.module("cat.service").service("$breadcrumbs",e)}(window,document),function(t){"use strict";angular.module("cat.service").factory("catListDataLoadingService",["catApiService","$route","$q",function(e,n,i){var r=function(t,e){var n=i.defer();return t.list(e).then(function(i){var r=e.pagination();n.resolve({count:i.totalCount,collection:i.elements,pagination:r,firstResult:(r.page-1)*r.size+1,lastResult:Math.min(r.page*r.size,i.totalCount),facets:i.facets,isSinglePageList:i.totalCount<=r.size,endpoint:t,searchRequest:e})},function(t){n.reject(t)}),n.promise},a=function(i,a){var o=new t.cat.SearchRequest(n.current.params);return a||(a={property:"name",isDesc:!1}),a&&!n.current.params.sort&&o.sort(a),r(e[i],o)};return{load:r,resolve:a}}])}(window,document),function(t){"use strict";function e(e){var n=[];this.listAndDetailRoute=function(i,r,a){n.push(r);var o=i+"/"+t.cat.util.pluralize(r.toLowerCase());a&&a.url&&(o=i+"/"+a.url||o);var s=a?a.list:{},c=a?a.details:{},u={name:r};e.when(o,t.cat.util.route.list(_.assign({},u,s))).when(o+"/:id",t.cat.util.route.detail(_.assign({},u,c)))},this.$get=function(){return n}}angular.module("cat.service").provider("catRouteService",e)}(window,document),function(t,e,n){"use strict";function i(t,e){return _.assign(t,e,function(t,e){return _.isObject(t)&&_.isObject(e)?i(t,e):e})}function r(t){this.getConfig=function(e,r){var a=t[e];return _.isUndefined(a)&&_.isUndefined(r)?n:i(_.clone(a)||{},r)}}function a(){var t={};this.config=function(e,n){return _.isUndefined(n)||(t[e]=n),t[e]},this.$get=function(){return new r(t)}}angular.module("cat.service").provider("catSelectConfigService",a)}(window,document),function(t){"use strict";function e(e,n){var i=[],r=[];this.listAndDetailView=function(a,o,s){var c=o.toLowerCase(),u=t.cat.util.pluralize(c);s&&(u=s.url||u);var l={model:t.cat.util.defaultModelResolver(o),url:u};s&&(l=_.assign(l,s.endpoint)),i.push(o),r.push(c),n.endpoint(o.toLowerCase(),l),e.listAndDetailRoute(a,o,s)},this.$get=function(){return{views:i,endpoints:r}}}angular.module("cat.service").provider("catViewService",e)}(window,document),function(){"use strict";angular.module("cat.service").factory("errorHttpInterceptor",function(t,e,n){return{request:function(t){return n.start(),t},requestError:function(e){return n.stop(),t.reject(e)},response:function(t){return n.stop(),t},responseError:function(i){if(n.stop(),e.clearMessages("error"),i.data.error){var r="["+i.status+" - "+i.statusText+"] "+i.data.error;i.data.cause&&(r+="\n"+i.data.cause),e.addMessage("error",r)}return i.data.globalErrors&&e.addMessages("error",i.data.globalErrors),t.reject(i)}}}).config(function(t){t.interceptors.push("errorHttpInterceptor")})}(window,document),function(t,e,n){"use strict";angular.module("cat.service").factory("loadingService",function(t,e,i){var r,a,o,s=50,c=200,u=0,l=function(){u||a||(o&&(i.cancel(o),o=n),a=i(function(){e.spin("loading-spinner"),t.loading=!0,r=(new Date).getTime()},s)),u++},d=function(){if(u--,!u&&!o){a&&(i.cancel(a),a=n);var l=(new Date).getTime(),d=s+Math.max(c-(l-r),0);o=i(function(){e.stop("loading-spinner"),t.loading=!1},d)}};return t.$on("$routeChangeStart",function(){l()}),t.$on("$routeChangeSuccess",function(){d()}),t.$on("$routeChangeError",function(){d()}),{start:l,stop:d}})}(window,document),function(t,e,n){"use strict";function i(t,e){this.id=t;var n=e;this.getOptions=function(){return n},this.isGroup=function(){return!1},this.isMenu=function(){return!1}}function r(t,e){this.id=t;var n=[],r=e;this.addMenuEntry=function(t,e){n.push(new i(t,e))},this.getOptions=function(){return r},this.getEntries=function(){return _.sortBy(n,function(t){return t.getOptions().sortOrder||1e4})},this.isGroup=function(){return!0},this.isMenu=function(){return!1}}function a(t,e){this.id=t;var n=[],a={},o=e;this.addMenuGroup=function(t,e){a[t]=new r(t,e)},this.addMenuEntry=function(t,e,r){_.isUndefined(t)?n.push(new i(e,r)):a[t].addMenuEntry(e,r)},this.getGroups=function(){return _.sortBy(_.map(a,function(t){return t}),function(t){return t.getOptions().sortOrder||1e4})},this.getEntries=function(t){return _.isUndefined(t)?_.sortBy(n,function(t){return t.getOptions().sortOrder||1e4}):a[t].getEntries()},this.getFlattened=function(){return _.flatten([n,_.map(this.getGroups(),function(t){return[t,t.getEntries()]})])},this.isMenu=function(){return!0},this.isGroup=function(){return!1},this.getOptions=function(){return o}}function o(t,e){this.id=t;var n={},i=e;this.addMenu=function(t,e){n[t]=new a(t,e)},this.addMenuGroup=function(t,e,i){n[t].addMenuGroup(e,i)},this.addMenuEntry=function(t,e,i,r){n[t].addMenuEntry(e,i,r)},this.getMenus=function(){return _.map(n,function(t){return t})},this.getOptions=function(){return i}}function s(){var t=new o("main.menu",{}),e=[],i=[],r=[];this.menu=function(t,n){e.push({menuId:t,options:n})},this.menuGroup=function(t,e,n){i.push({menuId:t,groupId:e,options:n})},this.menuEntry=function(t,e,i,a){_.isUndefined(a)&&(a=i,i=e,e=n),r.push({menuId:t,groupId:e,entryId:i,options:a})},this.$get=function(){return _.forEach(e,function(e){t.addMenu(e.menuId,e.options)}),_.forEach(i,function(e){t.addMenuGroup(e.menuId,e.groupId,e.options)}),_.forEach(r,function(e){t.addMenuEntry(e.menuId,e.groupId,e.entryId,e.options)}),t}}angular.module("cat.service").provider("$mainMenu",s)}(window,document),function(){"use strict";angular.module("cat.service").service("$globalMessages",function(t){var e={},n=this;this.getMessages=function(t){return t?e[t]:[]},this.hasMessages=function(t){return t?!!e[t]&&0!==e[t].length:!1},this.clearMessages=function(t){return t?void(e[t]=[]):void(e={})},this.addMessage=function(t,i){t&&(e[t]||n.clearMessages(t),e[t].push(i))},this.addMessages=function(t,e){t&&_.forEach(e,function(e){n.addMessage(t,e)})},this.setMessages=function(t,e){t&&(n.clearMessages(t),e&&n.addMessages(t,e))},t.$on("$routeChangeSuccess",function(){n.clearMessages()})})}(window,document),function(t){"use strict";t.cat.util=t.cat.util||{},t.cat.util.pluralize=function(t){if(_.isUndefined(t)||0===t.length)return"";var e=t[t.length-1];switch(e){case"y":return t.substring(0,t.length-1)+"ies";case"s":return t+"es";default:return t+"s"}}}(window,document),function(t){"use strict";t.cat.util=t.cat.util||{},t.cat.models=t.cat.models||{},t.cat.util.defaultModelResolver=function(e){return t.cat.models[e]};var e=function(t){return t?t.toLowerCase():""},n=function(t,e,n){return _.isUndefined(e)&&(e=t.current.originalPath,0!==_.keys(t.current.pathParams).length&&(e=e.substring(0,e.lastIndexOf("/"))),_.isArray(n)&&_.forEach(n,function(n){var i=n+"Id";e=e.replace(":"+i,t.current.params[i])})),e},i=function(i){function r(t){return t.resolve(i.endpoint||o,i.defaultSort)}function a(e,a,s){var c=e.defer(),u={controller:i.controller||i.name+"Controller",baseUrl:n(a,i.baseUrl),title:t.cat.util.pluralize(i.name),searchProps:i.searchProps||t.cat.util.defaultListSearchProps,listTemplateUrl:i.listTemplateUrl||o+"/"+o+"-list.tpl.html"};return r(s).then(function(t){u.listData=t,c.resolve(u)}),c.promise}var o=e(i.name);return{reloadOnSearch:!1,controller:"CatBaseListController",controllerAs:"catBaseListController",templateUrl:i.templateUrl||"template/cat-base-list.tpl.html",resolve:{config:a}}},r=function(i){function r(t,e){var n=e[c];return _.isArray(u)&&(_.forEach(u,function(i,r){var a;a=0===r?e[i]:n[i],n=a.res(t.current.params[i+"Id"])}),n=n[c]),n}function a(t,e,n){var i,r=t.current.params.id;return i="new"===r?e.when(new l):n.get(r)}function o(t,e,o){var c=e.defer(),d=r(t,o),f=n(t,i.baseUrl,u),h={controller:i.controller||i.name+"DetailsController",endpoint:d,Model:l,templateUrls:p,baseUrl:f},m=a(t,e,d);m.then(function(t){h.detail=t});var g=s(e,d);return g.then(function(t){h.parents=t}),e.all([m,g]).then(function(){c.resolve(h)},function(t){c.reject(t)}),c.promise}function s(t,e){if(_.isUndefined(e)||_.isUndefined(e.parentInfo))return t.when([]);var n=t.defer(),i=[];return e.parentInfo().then(function(r){i.push(r),s(t,e.parentEndpoint).then(function(t){i.push(t),i=_.flatten(i),n.resolve(i)},function(t){n.reject(t)})},function(t){n.reject(t)}),n.promise}var c,u;_.isString(i.endpoint)?c=i.endpoint:_.isObject(i.endpoint)?(u=i.endpoint.parents,c=i.endpoint.name):c=e(i.name);var l=i.model||t.cat.util.defaultModelResolver(i.name),d="",f="";_.isArray(u)&&_.forEach(u,function(t){d+=t,d+="/",f+=t,f+="-"});var p={edit:d+c+"/"+f+c+"-details-edit.tpl.html",view:d+c+"/"+f+c+"-details-view.tpl.html"};return i.additionalViewTemplate===!0&&(p.view={main:p.view,additional:d+c+"/"+f+c+"-additional-details-view.tpl.html"}),{templateUrl:i.templateUrl||"template/base-detail.tpl.html",controller:"CatBaseDetailController",reloadOnSearch:i.reloadOnSearch,resolve:{config:function(t,e,n){return o(t,e,n)}}}};t.cat.util.route={list:i,detail:r}}(window,document);