/*
 * Copyright 2014 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(t){"use strict";t.cat={},angular.module("cat.directives",["ui.select2"]),angular.module("cat.controller",[]),angular.module("cat.template",[]),angular.module("cat.service.api",[]),angular.module("cat.service",["angularSpinner","ngRoute","cat.service.api"]),angular.module("cat",["cat.service","cat.template","cat.directives","cat.controller"])}(window,document),function(t,e,n){"use strict";t.cat=t.cat||{},t.cat.FacetTerm=function(t){t===n&&(t={}),this.id=t.id,this.name=t.name,this.count=t.count},t.cat.Facet=function(e){e===n&&(e={}),this.name=e.name,this.terms=_.map(e.facets,function(e){return new t.cat.FacetTerm(e)})}}(window,document),function(t,e,n){"use strict";t.cat=t.cat||{},t.cat.SearchRequest=function(t){var e,r={page:1,size:100},i={},a={};t&&!_.isEmpty(t)&&(r.page=t.page||r.page,r.size=t.size||r.size,i.property=t.sort||i.property,i.isDesc=t.rev||i.isDesc,_.forEach(_.keys(t),function(e){e.indexOf("search.")>-1&&e.length>7&&(a[e.substring(7)]=t[e])}));var o=function(){return i.property?"sort="+i.property+":"+(i.isDesc===!0||"true"===i.isDesc?"desc":"asc"):""},s=function(){return"page="+(r.page?Math.max(0,r.page-1):0)+"&size="+r.size||100},c=function(t,e){return t?e?t+"&"+e:t:e},u=function(){return a&&!_.isEmpty(a)?$.param(a):""},l=function(){return _([s(),o(),u()]).reduce(c)};this.pagination=function(t){return t===n?r:r=t},this.sort=function(t){return t===n?i:i=t},this.search=function(t){return t===n?a:a=t},this.urlEncoded=function(){return e=l()},this.isDirty=function(){return e!==l()},this.setSearch=function(t){var e={};e.page=r.page,e.size=r.size,i.property&&(e.sort=i.property,e.rev=i.isDesc||!1),_.forEach(_.keys(a),function(t){e["search."+t]=a[t]}),t.search(e)}}}(window,document),function(t,e,n){"use strict";function r(t,e,r,i,a,o,s,c,u,l){function d(t){return t.charAt(0).toUpperCase()+t.substring(1)}function f(t,e){return _.initial(t.split("/"),e).join("/")}t.detail=u,t.editDetail=n,t.$fieldErrors={};var p=c.endpoint,h=c.baseUrl,m=c.templateUrls,g=c.Model,v=[];if(t.uiStack=[],_.isUndefined(c.endpoint.parentEndpoint))v.push({title:d(c.endpoint.getEndpointName())+"s",url:"#"+h});else for(var w=c.endpoint,$=w.parentEndpoint,y=h,E=0;!_.isUndefined($);){var b=l[E++];y=f(y,1);var D={url:"#"+y+"?tab="+w.getEndpointName()+"s",title:b.name};t.uiStack.unshift(D),v.unshift(D),y=f(y,1);var C={title:d($.getEndpointName())+"s",url:"#"+y};v.unshift(C),w=$,$=w.parentEndpoint}v.push({title:"new"===e.id?"New":""}),r.set(v),t.editTemplate=m.edit,_.isObject(m.view)?(t.mainViewTemplate=m.view.main,t.additionalViewTemplate=m.view.additional):t.mainViewTemplate=m.view,t.baseUrl=h,t.title=function(){var e=t.detail;return _.isUndefined(e)?"":e.breadcrumbTitle?e.breadcrumbTitle():e.name?e.name:e.id};var M=function(){r.replaceLast({title:t.title()})},S=function(){p.get(e.id).then(function(e){t.detail=e,M()})};t.reloadDetails=S,t.exists=!!e.id&&"new"!==e.id,t.add=function(){t.editDetail=new g,_.isFunction(t.editDetail.setParent)&&t.editDetail.setParent(l[0])},t.edit=function(){t.editDetail=angular.copy(t.detail),_.isFunction(t.editDetail.setParent)&&t.editDetail.setParent(l[0])},t.cancelEdit=function(){t.$broadcast("formReset"),t.exists?(t.editDetail=n,o.clearMessages(),t.$fieldErrors=n):a.history.back()},t.remove=function(){p.remove(t.detail.id).then(function(){i.path(h)})},t.save=function(){p.save(t.editDetail).then(function(e){o.clearMessages(),t.$fieldErrors=n,t.exists?(t.editDetail=n,t.detail=e,M()):(t.$broadcast("formReset"),i.path(h+"/"+e.id))},function(e){if(!e.data.fieldErrors)return void(t.$fieldErrors=n);var r={};_.forEach(e.data.fieldErrors,function(t){r[t.field]=r[t.field]||[],r[t.field].push(t.message)}),t.$fieldErrors=r,t.$broadcast("fieldErrors",r)})},t.exists?_.isUndefined(t.detail)?S():M():_.isUndefined(t.detail)?t.add():t.edit(),s(c.controller,{$scope:t,detail:u,parents:l,config:c})}angular.module("cat").controller("CatBaseDetailController",r)}(window,document),function(){"use strict";angular.module("cat").directive("catAutofocus",function(t){return{restrict:"A",link:function(e,n){t(function(){n[0].focus()},100)}}})}(window,document),function(){"use strict";angular.module("cat").directive("catCheckbox",function(){return{replace:!0,restrict:"E",scope:{checked:"="},link:function(t,e){e.addClass(t.checked?"glyphicon glyphicon-check":"glyphicon glyphicon-unchecked")}}})}(window,document),function(t){"use strict";angular.module("cat").directive("catConfirmClick",function(){return{restrict:"A",link:function(e,n,r){var i=r.catConfirmClick||"Are you sure?",a=r.catOnConfirm;n.bind("click",function(){t.confirm(i)&&e.$eval(a)})}}})}(window,document),function(t,e,n){"use strict";angular.module("cat").directive("catFacets",function(){return{replace:!0,restrict:"E",scope:{facets:"=",names:"="},templateUrl:"template/cat-facets.tpl.html",link:function(t){if(t.facets===n)throw"Attribute facets must be set!"},controller:function(e,r,i){e.isActive=function(t,e){var n=r.search(),i="search."+t.name;return n[i]?!!e&&n[i]===e.id:!0},e.showAll=function(e){var n=new t.cat.SearchRequest(r.search()).search();delete n[e.name],i.$broadcast("SearchChanged",n)},e.facetName=function(t){return e.names!==n&&e.names[t.name]!==n?e.names[t.name]:t.name},e.setActive=function(e,n){e.activeTerm=n;var a=new t.cat.SearchRequest(r.search()).search();a[e.name]=n.id,i.$broadcast("SearchChanged",a)},e.remove=function(e){var n=new t.cat.SearchRequest(r.search()).search();delete n[e.name],i.$broadcast("SearchChanged",n)},e.showItem=function(t,n){return e.isActive(t)||e.isActive(t,n)}}}})}(window,document),function(){"use strict";angular.module("cat").directive("catFieldErrors",function(){return{replace:"true",restrict:"E",scope:{errors:"=",name:"@"},template:'<div class="label label-danger" ng-if="errors[name]"><ul><li ng-repeat="error in errors[name]">{{error}}</li></ul></div>'}})}(window,document),function(){"use strict";angular.module("cat").directive("input",function(){return{require:"ngModel",restrict:"E",link:function(t,e,n,r){t.$on("fieldErrors",function(t,e){if(e&&n.id){var i=!e[n.id];r.$setValidity(n.id,i)}})}}}).directive("catInputGroup",function(){return{restrict:"A",transclude:!0,scope:{errors:"=",label:"@",name:"@"},link:function(t,e){e.addClass("form-group")},templateUrl:"template/cat-input.tpl.html"}})}(window,document),function(){"use strict";angular.module("cat").directive("catLoadMore",function(){return{replace:!0,restrict:"A",link:function(t,e,n){var r=parseInt(n.catLoadMore);if(t.$parent.elementsCount=t.$parent.elementsCount||r,t.$parent.elements=t.$parent.elements||[],t.$parent.elements.push(e),t.$parent.elements.length>t.$parent.elementsCount&&e.addClass("hidden"),!e.parent().next().length&&t.$parent.elements.length>t.$parent.elementsCount){var i=$('<a href="#">Show more</a>');i.on({click:function(){return t.$parent.elementsCount+=r,t.$parent.elements.length<=t.$parent.elementsCount&&i.addClass("hidden"),t.$parent.elements.forEach(function(e,n){n<t.$parent.elementsCount&&e.removeClass("hidden")}),!1}}),e.parent().after(i)}}}})}(window,document),function(){"use strict";angular.module("cat").directive("catMainMenu",["$mainMenu","$rootScope",function(t,e){return{restrict:"E",scope:{},link:function(n){n.menus=t.getMenus(),n.isVisible=function(t){var e=!1;return t.isMenu()||t.isGroup()?(_.forEach(t.getEntries(),function(t){e=e||n.isVisible(t)}),t.isMenu()&&_.forEach(t.getGroups(),function(t){e=e||n.isVisible(t)}),e):n.isAllowed(t)},n.isAllowed=function(t){var n=t.getOptions().rights;if(n){if(_.isArray(n)){for(var r=!0,i=0;i<n.length;i++)r=r&&e.isAllowed(n[i]);return r}return e.isAllowed(n)}return!0}},templateUrl:"template/cat-main-menu.tpl.html"}}])}(window,document),function(){"use strict";angular.module("cat").directive("catPaginated",function(){return{replace:!0,restrict:"E",transclude:!0,scope:{listData:"=?",syncLocation:"=?"},templateUrl:"template/cat-paginated.tpl.html",link:function(t,e,n){n.searchProps&&(t.searchProps=_.filter(n.searchProps.split(","),function(t){return!!t}))},controller:function(t,e,n,r,i){function a(){t.syncLocation!==!1&&(c.setSearch(e),e.replace())}var o=null,s=500;if(_.isUndefined(t.listData)&&(t.listData=t.$parent.listData,_.isUndefined(t.listData)))throw new Error("listData was not defined and couldn't be found with default value");_.isUndefined(t.syncLocation)&&(t.syncLocation=_.isUndefined(t.$parent.detail)),t.listData.search=t.listData.search||t.listData.searchRequest.search()||{};var c=t.listData.searchRequest,u=function(e){r.cancel(o),o=r(function(){c.isDirty()&&n.load(t.listData.endpoint,c).then(function(e){_.assign(t.listData,e)})},e||0)};t.$watch("listData.sort",function(e){e&&(console.log("broadcasting sort changed: "+angular.toJson(e)),t.$parent.$broadcast("SortChanged",e))},!0),t.$on("SearchChanged",function(t,e,n){l(e,n)}),t.$watch("listData.pagination",function(){a(),u()},!0);var l=function(e,n){c.search(e),a(),t.listData.pagination.page=1,u(n)},d=function(t){var e=c.search();_.assign(e,t),i.$broadcast("SearchChanged",e,s)};t.$watch("listData.search",d,!0),t.$on("SortChanged",function(e,n){c.sort(n),a(),t.listData.pagination.page=1,u()})}}})}(window,document),function(t){"use strict";function e(t,e){e.addClass("form-control")}function n(t,e,n,r){var a=r.getConfig(t.config,t.options);if(_.isUndefined(a))throw new Error('At least one of "config" or "options" has to be specified');var o,s,c=a.search||function(t,e){return{"search.name":t,page:e}},u=a.filter||function(){return!0};if(_.isArray(a.endpoint))o=function(t){return t.success({elements:a.endpoint})},s=0;else if(_.isObject(a.endpoint))o=i(a.endpoint,a.sort),s=500;else{if(!_.isString(a.endpoint))return e.error("The given endpoint has to be one of the following types: array, object, string - but was "+typeof a.endpoint),void(t.elements=[]);var l=n[a.endpoint];if(!l)return e.error('No api endpoint "'+a.endpoint+'" defined'),void(t.elements=[]);o=i(l,a.sort),s=500}t.selectOptions=_.assign({placeholder:" ",minimumInputLength:0,adaptDropdownCssClass:function(t){return _.contains(["ng-valid","ng-invalid","ng-pristine","ng-dirty"],t)?t:null},ajax:{data:c,quietMillis:s,transport:o,results:function(t,e){var n=(e*a.size||100)<t.totalCount;return{results:_.filter(t.elements,u),more:n}}},formatResult:function(t){return t.name},formatSelection:function(t){return t.name}},a["ui-select2"])}function r(){return{restrict:"EA",replace:!0,priority:1,scope:{options:"=?",id:"@",config:"@?"},link:e,controller:n,template:'<input type="text" ui-select2="selectOptions">'}}var i=function(e,n){return function(r){var i=new t.cat.SearchRequest(r.data);return i.sort(n||{property:"name",isDesc:!1}),e.list(i).then(r.success)}};angular.module("cat.directives").directive("catSelect",r)}(window,document),function(){"use strict";angular.module("cat").directive("catSortable",function(t){return{restrict:"AC",link:function(e,n,r){var i=n.text(),a=r.catSortable||i.toLowerCase().trim();e.sort=e.listData.searchRequest.sort();var o="glyphicon-sort-by-attributes";r.sortMode&&("numeric"===r.sortMode?o="glyphicon-sort-by-order":"alphabet"===r.sortMode&&(o="glyphicon-sort-by-alphabet")),n.text(""),n.append(t('<a class="sort-link" href="" ng-click="toggleSort(\''+a+"')\">"+i+' <span class="glyphicon" ng-class="{\''+o+"': sort.property == '"+a+"' && !sort.isDesc, '"+o+"-alt': sort.property == '"+a+"' && sort.isDesc}\"></span></a>")(e))},controller:function(t){t.toggleSort=function(e){t.sort.property===e?t.sort.isDesc=!t.sort.isDesc:(t.sort.property=e,t.sort.isDesc=!1),t.$parent.$broadcast("SortChanged",t.sort)},t.$on("SortChanged",function(e,n){t.sort=n})}}})}(window,document),function(t){"use strict";angular.module("cat").directive("form",["$timeout",function(e){return{restrict:"E",scope:!0,require:"form",link:function(n,r,i,a){var o=i.eocsWarnOnNavIfDirty||"You have unsaved changes. Leave the page?";e(function(){a.$setPristine(!0)},50),n.$on("formReset",function(){a.$setPristine(!0)}),n.$on("formDirty",function(){a.$setDirty(!0)}),n.$on("$locationChangeStart",function(e){a.$dirty&&(t.confirm(o)||e.preventDefault())}),$(t).on("beforeunload",function(){return a.$dirty?o:void 0}),n.$on("$destroy",function(){$(t).unbind("beforeunload")})}}}])}(window,document),function(){"use strict";angular.module("cat").directive("numbersOnly",function(){return{require:"ngModel",link:function(t,e,n,r){r.$parsers.push(function(t){if(!t)return"";var e="[^0-9]";n.hasOwnProperty("allowFraction")&&(e="[^0-9,.]");var i=t.replace(new RegExp(e,"g"),"");return i!==t&&(r.$setViewValue(i),r.$render()),i})}}})}(window,document),function(t,e,n){"use strict";angular.module("cat").filter("replaceText",function(){return function(t,e,r,i){return e===n&&(e="\n"),r===n&&(r="g"),i===n&&(i=", "),t?String(t).replace(new RegExp(e,r),i):t}})}(window,document),function(){"use strict";angular.module("cat.service").service("$breadcrumbs",function(){var t=[];this.clear=function(){t=[]},this.set=function(e){t=e},this.get=function(){return t},this.push=function(e){t.push(e)},this.pop=function(){t.pop()},this.length=function(){return t.length},this.replaceLast=function(e){t[t.length-1]=e}})}(window,document),function(t){"use strict";function e(n,r,i){var a=this,o=r.name,s=n+(r.config.url||r.name),c=r.config.model,u=r.children,l=_.memoize(function(t){var n=s+"/"+t+"/",r={};return _.forEach(_.keys(u),function(o){r[o]=new e(n,u[o],i),r[o].parentEndpoint=a,r[o].parentId=t,r[o].parentInfo=function(){return a.info(t)}}),r});this.res=function(t){return l(t)};var d=function(t){var e=new c(t);return _.merge(e,l(e.id))},f=function(t){var e=l(t.id);return _.forEach(_.keys(e),function(e){delete t[e]}),t};this.getEndpointUrl=function(){return s},this.getEndpointName=function(){return o},this.list=function(e){var n=e&&e instanceof t.cat.SearchRequest?"?"+e.urlEncoded():"";return i.get(s+n).then(function(e){if(e.data.totalCount||0===e.data.totalCount){var n=[];return e.data.facets&&(n=_.map(e.data.facets,function(e){return new t.cat.Facet(e)})),{totalCount:e.data.totalCount,facets:n,elements:_.map(e.data.elements,function(t){return d(t)})}}return _.map(e.data,function(t){return d(t)})})},this.all=function(){return i.get(s+"/all").then(function(t){return _.map(t.data,function(t){return d(t)})})},this.get=function(t){return i.get(s+"/"+t).then(function(t){return d(t.data)})},this.info=function(t){return i.get(s+"/"+t+"?info").then(function(t){return t.data})},this.save=function(t){return t.id?i.put(s+"/"+t.id,f(t)).then(function(t){return d(t.data)}):i.post(s,f(t)).then(function(t){return d(t.data)})},this.remove=function(t){return i({method:"DELETE",url:s+"/"+t})}}function n(t,e){var r=this;if(this.config=e||{},this.children={},this.name=t,this.child=function(t,e){return _.isUndefined(e)||(this.children[t]=new n(t,e),this.children[t].parent=this),this.children[t]},!_.isUndefined(this.config.children)){var i=this.config.children;delete this.config.children,_.forEach(_.keys(i),function(t){r.child(t,i[t])})}}function r(){var t="/api/";this.endpoint=function(t,e){return _.isUndefined(e)||(i[t]=new n(t,e)),i[t]},this.$get=["$http",function(n){var r={};return _.forEach(_.keys(i),function(a){r[a]=new e(t,i[a],n)}),r}]}var i={};angular.module("cat.service.api").provider("catApiService",r),angular.module("cat.service.api").provider("$api",r)}(window,document),function(t){"use strict";angular.module("cat.service").factory("catListDataLoadingService",["catApiService","$route","$q",function(e,n,r){var i=function(t,e){var n=r.defer();return t.list(e).then(function(r){var i=e.pagination();n.resolve({count:r.totalCount,collection:r.elements,pagination:i,firstResult:(i.page-1)*i.size+1,lastResult:Math.min(i.page*i.size,r.totalCount),facets:r.facets,isSinglePageList:r.totalCount<=i.size,endpoint:t,searchRequest:e})},function(t){n.reject(t)}),n.promise},a=function(r,a){var o=new t.cat.SearchRequest(n.current.params);return a||(a={property:"name",isDesc:!1}),a&&!n.current.params.sort&&o.sort(a),i(e[r],o)};return{load:i,resolve:a}}])}(window,document),function(t){"use strict";function e(e){var n=[];this.listAndDetailRoute=function(r,i,a){n.push(i);var o=r+"/"+i.toLowerCase()+"s";a&&a.url&&(o=r+"/"+a.url||o);var s=a?a.list:{},c=a?a.details:{},u={name:i};e.when(o,t.cat.util.route.list(_.assign({},u,s))).when(o+"/:id",t.cat.util.route.detail(_.assign({},u,c)))},this.$get=function(){return n}}angular.module("cat.service").provider("catRouteService",e)}(window,document),function(t,e,n){"use strict";function r(t,e){return _.assign(t,e,function(t,e){return _.isObject(t)&&_.isObject(e)?r(t,e):e})}function i(t){this.getConfig=function(e,i){var a=t[e];return _.isUndefined(a)&&_.isUndefined(i)?n:r(_.clone(a)||{},i)}}function a(){var t={};this.config=function(e,n){t[e]=n},this.$get=function(){return new i(t)}}angular.module("cat.service").provider("catSelectConfigService",a)}(window,document),function(t){"use strict";function e(e,n){var r=[],i=[];this.listAndDetailView=function(a,o,s){var c=o.toLowerCase(),u=c+"s";s&&(u=s.url||u);var l={model:t.cat.util.defaultModelResolver(o),url:u};s&&(l=_.assign(l,s.endpoint)),r.push(o),i.push(c),n.endpoint(o.toLowerCase(),l),e.listAndDetailRoute(a,o,s)},this.$get=function(){return{views:r,endpoints:i}}}angular.module("cat.service").provider("catViewService",e)}(window,document),function(){"use strict";angular.module("cat.service").factory("errorHttpInterceptor",function(t,e,n){return{request:function(t){return n.start(),t},requestError:function(e){return n.stop(),t.reject(e)},response:function(t){return n.stop(),t},responseError:function(r){if(n.stop(),e.clearMessages("error"),r.data.error){var i="["+r.status+" - "+r.statusText+"] "+r.data.error;r.data.cause&&(i+="\n"+r.data.cause),e.addMessage("error",i)}return r.data.globalErrors&&e.addMessages("error",r.data.globalErrors),t.reject(r)}}}).config(function(t){t.interceptors.push("errorHttpInterceptor")})}(window,document),function(t,e,n){"use strict";angular.module("cat.service").factory("loadingService",function(t,e,r){var i,a,o,s=50,c=200,u=0,l=function(){u||a||(o&&(r.cancel(o),o=n),a=r(function(){e.spin("loading-spinner"),t.loading=!0,i=(new Date).getTime()},s)),u++},d=function(){if(u--,!u&&!o){a&&(r.cancel(a),a=n);var l=(new Date).getTime(),d=s+Math.max(c-(l-i),0);o=r(function(){e.stop("loading-spinner"),t.loading=!1},d)}};return t.$on("$routeChangeStart",function(){l()}),t.$on("$routeChangeSuccess",function(){d()}),t.$on("$routeChangeError",function(){d()}),{start:l,stop:d}})}(window,document),function(t,e,n){"use strict";function r(t,e){this.id=t;var n=e;this.getOptions=function(){return n},this.isGroup=function(){return!1},this.isMenu=function(){return!1}}function i(t,e){this.id=t;var n=[],i=e;this.addMenuEntry=function(t,e){n.push(new r(t,e))},this.getOptions=function(){return i},this.getEntries=function(){return _.sortBy(n,function(t){return t.getOptions().sortOrder||1e4})},this.isGroup=function(){return!0},this.isMenu=function(){return!1}}function a(t,e){this.id=t;var n=[],a={},o=e;this.addMenuGroup=function(t,e){a[t]=new i(t,e)},this.addMenuEntry=function(t,e,i){_.isUndefined(t)?n.push(new r(e,i)):a[t].addMenuEntry(e,i)},this.getGroups=function(){return _.sortBy(_.map(a,function(t){return t}),function(t){return t.getOptions().sortOrder||1e4})},this.getEntries=function(t){return _.isUndefined(t)?_.sortBy(n,function(t){return t.getOptions().sortOrder||1e4}):a[t].getEntries()},this.getFlattened=function(){return _.flatten([n,_.map(this.getGroups(),function(t){return[t,t.getEntries()]})])},this.isMenu=function(){return!0},this.isGroup=function(){return!1},this.getOptions=function(){return o}}function o(t,e){this.id=t;var n={},r=e;this.addMenu=function(t,e){n[t]=new a(t,e)},this.addMenuGroup=function(t,e,r){n[t].addMenuGroup(e,r)},this.addMenuEntry=function(t,e,r,i){n[t].addMenuEntry(e,r,i)},this.getMenus=function(){return _.map(n,function(t){return t})},this.getOptions=function(){return r}}function s(){var t=new o("main.menu",{}),e=[],r=[],i=[];this.menu=function(t,n){e.push({menuId:t,options:n})},this.menuGroup=function(t,e,n){r.push({menuId:t,groupId:e,options:n})},this.menuEntry=function(t,e,r,a){_.isUndefined(a)&&(a=r,r=e,e=n),i.push({menuId:t,groupId:e,entryId:r,options:a})},this.$get=function(){return _.forEach(e,function(e){t.addMenu(e.menuId,e.options)}),_.forEach(r,function(e){t.addMenuGroup(e.menuId,e.groupId,e.options)}),_.forEach(i,function(e){t.addMenuEntry(e.menuId,e.groupId,e.entryId,e.options)}),t}}angular.module("cat.service").provider("$mainMenu",s)}(window,document),function(){"use strict";angular.module("cat.service").service("$globalMessages",function(t){var e={},n=this;this.getMessages=function(t){return t?e[t]:[]},this.hasMessages=function(t){return t?!!e[t]&&0!==e[t].length:!1},this.clearMessages=function(t){return t?void(e[t]=[]):void(e={})},this.addMessage=function(t,r){t&&(e[t]||n.clearMessages(t),e[t].push(r))},this.addMessages=function(t,e){t&&_.forEach(e,function(e){n.addMessage(t,e)})},this.setMessages=function(t,e){t&&(n.clearMessages(t),e&&n.addMessages(t,e))},t.$on("$routeChangeSuccess",function(){n.clearMessages()})})}(window,document),function(t){"use strict";t.cat.util=t.cat.util||{},t.cat.models=t.cat.models||{},t.cat.util.defaultModelResolver=function(e){return t.cat.models[e]};var e=function(t){return t?t.toLowerCase():""},n=function(t){var n=e(t.name);return{templateUrl:t.templateUrl||n+"/"+n+"-list.tpl.html",controller:t.controller||t.name+"Controller",reloadOnSearch:!1,resolve:{listData:["catListDataLoadingService",function(e){return e.resolve(t.endpoint||n,t.defaultSort)}]}}},r=function(n){function r(t,e){if(!_.isUndefined(d))return d;var r=e.current.originalPath,i=t[a];_.isArray(o)&&(_.forEach(o,function(n,r){var a;a=0===r?t[n]:i[n],i=a.res(e.current.params[n+"Id"])}),i=i[a]);var c=n.baseUrl;if(_.isUndefined(c)){var u=r.substring(0,r.lastIndexOf("/"));_.isArray(o)?_.forEach(o,function(t){var n=t+"Id";c=u.replace(":"+n,e.current.params[n])}):c=u}return d={controller:n.controller||n.name+"DetailsController",endpoint:i,Model:s,templateUrls:l,baseUrl:c}}function i(t,e){if(_.isUndefined(e)||_.isUndefined(e.parentInfo))return t.when([]);var n=t.defer(),r=[];return e.parentInfo().then(function(a){r.push(a),i(t,e.parentEndpoint).then(function(t){r.push(t),r=_.flatten(r),n.resolve(r)},function(t){n.reject(t)})},function(t){n.reject(t)}),n.promise}var a,o;_.isString(n.endpoint)?a=n.endpoint:_.isObject(n.endpoint)?(o=n.endpoint.parents,a=n.endpoint.name):a=e(n.name);var s=n.model||t.cat.util.defaultModelResolver(n.name),c="",u="";_.isArray(o)&&_.forEach(o,function(t){c+=t,c+="/",u+=t,u+="-"});var l={edit:c+a+"/"+u+a+"-details-edit.tpl.html",view:c+a+"/"+u+a+"-details-view.tpl.html"};n.additionalViewTemplate===!0&&(l.view={main:l.view,additional:c+a+"/"+u+a+"-additional-details-view.tpl.html"});var d;return{templateUrl:n.templateUrl||"template/base-detail.tpl.html",controller:"CatBaseDetailController",reloadOnSearch:n.reloadOnSearch,resolve:{config:function(t,e){return r(t,e)},parents:["catApiService","$route","$q",function(t,e,n){return _.isUndefined(o)?null:i(n,r(t,e).endpoint)}],detail:["catApiService","$route",function(t,e){var n=e.current.params.id;return"new"===n?new s:r(t,e).endpoint.get(n)}]}}};t.cat.util.route={list:n,detail:r}}(window,document);