!function(t){"use strict";t.cat={},angular.module("cat.service",["angularSpinner"]),angular.module("cat.directives",["ui.select2"]),angular.module("cat.controller",[]),angular.module("cat.template",[]),angular.module("cat.api",[]),angular.module("cat",["cat.api","cat.service","cat.template","cat.directives","cat.controller"])}(window,document),function(t){"use strict";function e(n,r,i,a){var o=n+(i.url||r),s=i.model,c=i.children,u=_.memoize(function(t){var n=o+"/"+t+"/",r={};return _.forEach(_.keys(c),function(t){var i=c[t];r[t]=new e(n,t,i,a)}),r});this.res=function(t){return u(t)};var l=function(t){var e=new s(t);return _.merge(e,u(e.id))},d=function(t){var e=u(t.id);return _.forEach(_.keys(e),function(e){delete t[e]}),t};this.list=function(e){var n=e&&e instanceof t.cat.SearchRequest?"?"+e.urlEncoded():"";return a.get(o+n).then(function(e){if(e.data.totalCount||0===e.data.totalCount){var n=[];return e.data.facets&&(n=_.map(e.data.facets,function(e){return new t.cat.Facet(e)})),{totalCount:e.data.totalCount,facets:n,elements:_.map(e.data.elements,function(t){return l(t)})}}return _.map(e.data,function(t){return l(t)})})},this.all=function(){return a.get(o+"/all").then(function(t){return _.map(t.data,function(t){return l(t)})})},this.get=function(t){return a.get(o+"/"+t).then(function(t){return l(t.data)})},this.save=function(t){return t.id?a.put(o+"/"+t.id,d(t)).then(function(t){return l(t.data)}):a.post(o,d(t)).then(function(t){return l(t.data)})},this.remove=function(t){return a({method:"DELETE",url:o+"/"+t})}}function n(){var t="/api/",n={};this.endpoint=function(t,e){n[t]=e},this.$get=["$http",function(r){var i={};return _.forEach(_.keys(n),function(a){var o=n[a];i[a]=new e(t,a,o,r)}),i}]}angular.module("cat.api").provider("$api",n)}(window,document),function(t,e,n){"use strict";t.cat=t.cat||{},t.cat.FacetTerm=function(t){t===n&&(t={}),this.name=t.name,this.count=t.count},t.cat.Facet=function(e){e===n&&(e={}),this.name=e.name,this.terms=_.map(e.facets,function(e){return new t.cat.FacetTerm(e)})}}(window,document),function(t,e,n){"use strict";t.cat=t.cat||{},t.cat.SearchRequest=function(t){var e={page:1,size:100},r={},i={};t&&!_.isEmpty(t)&&(e.page=t.page||e.page,e.size=t.size||e.size,r.property=t.sort||r.property,r.isDesc=t.rev||r.isDesc,_.forEach(_.keys(t),function(e){e.indexOf("search.")>-1&&e.length>7&&(i[e.substring(7)]=t[e])}));var a=function(){return r.property?"sort="+r.property+":"+(r.isDesc?"desc":"asc"):""},o=function(){return"page="+(e.page?Math.max(0,e.page-1):0)+"&size="+e.size||100},s=function(t,e){return t?e?t+"&"+e:t:e},c=function(){return i&&!_.isEmpty(i)?_.reduce(_.map(_.keys(i),function(t){var e=i[t];return _.isUndefined(e)||_.isNull(e)?n:_.isString(e)&&(e=e.trim(),0===e.length)?n:t+"="+e}),s):""};this.pagination=function(t){return t===n?e:e=t},this.sort=function(t){return t===n?r:r=t},this.search=function(t){return t===n?i:i=t},this.urlEncoded=function(){return _([o(),a(),c()]).reduce(s)},this.setSearch=function(t){var n={};n.page=e.page,n.size=e.size,r.property&&(n.sort=r.property,n.rev=r.isDesc||!1),_.forEach(_.keys(i),function(t){n["search."+t]=i[t]}),t.search(n)}}}(window,document),function(t,e,n){"use strict";t.BaseDetailController=function(t,e,r,i,a,o,s,c,u,l){t.detail=n,t.editDetail=n,t.$fieldErrors={},t.editTemplate=s.edit,_.isObject(s.view)?(t.mainViewTemplate=s.view.main,t.additionalViewTemplate=s.view.additional):t.mainViewTemplate=s.view,t.baseUrl=c;var d=function(){o.get(e.id).then(function(e){t.title=e.breadcrumbTitle?e.breadcrumbTitle():e.name?e.name:e.id,t.detail=e,r.replaceLast({title:t.title})})};t.reloadDetails=d,t.exists=!!e.id&&"new"!==e.id,t.add=function(){t.editDetail=new u},t.edit=function(){t.editDetail=angular.copy(t.detail)},t.cancelEdit=function(){t.$broadcast("formReset"),t.exists?(t.editDetail=n,l.clearMessages(),t.$fieldErrors=n):a.history.back()},t.remove=function(){o.remove(t.detail.id).then(function(){i.path(c)})},t.save=function(){o.save(t.editDetail).then(function(e){l.clearMessages(),t.$fieldErrors=n,t.exists?(t.editDetail=n,t.title=e.breadcrumbTitle?e.breadcrumbTitle():e.name,t.detail=e):(t.$broadcast("formReset"),i.path(c+"/"+e.id))},function(e){if(!e.data.fieldErrors)return void(t.$fieldErrors=n);var r={};_.forEach(e.data.fieldErrors,function(t){r[t.field]=r[t.field]||[],r[t.field].push(t.message)}),t.$fieldErrors=r,t.$broadcast("fieldErrors",r)})},t.exists?d():t.add()},t.BaseDetailController.$inject=["$scope","$routeParams","$breadcrumbs","$location","$window","endpoint","templateUrls","baseUrl","Model","$globalMessages"]}(window,document),function(t,e,n){"use strict";angular.module("cat").filter("replaceText",function(){return function(t,e,r,i){return e===n&&(e="\n"),r===n&&(r="g"),i===n&&(i=", "),t?String(t).replace(new RegExp(e,r),i):t}})}(window,document),function(){"use strict";angular.module("cat").directive("catAutofocus",function(t){return{restrict:"A",link:function(e,n){t(function(){n[0].focus()},100)}}})}(window,document),function(t,e,n){"use strict";angular.module("cat").directive("catFacets",function(){return{replace:!0,restrict:"E",scope:{facets:"=",names:"="},templateUrl:"template/cat-facets.tpl.html",link:function(t){if(t.facets===n)throw"Attribute facets must be set!"},controller:function(e,r,i){e.isActive=function(t,e){var n=r.search(),i="search."+t.name;return n[i]?n[i]===e.name:void 0},e.facetName=function(t){return e.names!==n&&e.names[t.name]!==n?e.names[t.name]:t.name},e.setActive=function(e,n){var a=new t.cat.SearchRequest(r.search()).search();a[e.name]=n.name,i.$broadcast("SearchChanged",a)},e.remove=function(e){var n=new t.cat.SearchRequest(r.search()).search();delete n[e.name],i.$broadcast("SearchChanged",n)}}}})}(window,document),function(){"use strict";angular.module("cat").directive("catFieldErrors",function(){return{replace:"true",restrict:"E",scope:{errors:"=",name:"@"},template:'<div class="label label-danger" ng-if="errors[name]"><ul><li ng-repeat="error in errors[name]">{{error}}</li></ul></div>'}})}(window,document),function(){"use strict";angular.module("cat").directive("input",function(){return{require:"ngModel",restrict:"E",link:function(t,e,n,r){t.$on("fieldErrors",function(t,e){if(e&&n.id){var i=!e[n.id];r.$setValidity(n.id,i)}})}}}).directive("catInputGroup",function(){return{restrict:"A",transclude:!0,scope:{errors:"=",label:"@",name:"@"},link:function(t,e){e.addClass("form-group")},templateUrl:"template/cat-input.tpl.html"}})}(window,document),function(){"use strict";angular.module("cat").directive("catMainMenu",["$mainMenu","$rootScope",function(t,e){return{restrict:"E",scope:{},link:function(n){n.menus=t.getMenus(),n.isVisible=function(t){var e=!1;return t.isMenu()||t.isGroup()?(_.forEach(t.getEntries(),function(t){e=e||n.isVisible(t)}),t.isMenu()&&_.forEach(t.getGroups(),function(t){e=e||n.isVisible(t)}),e):n.isAllowed(t)},n.isAllowed=function(t){var n=t.getOptions().rights;if(n){if(_.isArray(n)){for(var r=!0,i=0;i<n.length;i++)r=r&&e.isAllowed(n[i]);return r}return e.isAllowed(n)}return!0}},templateUrl:"template/cat-main-menu.tpl.html"}}])}(window,document),function(t,e,n){"use strict";angular.module("cat").directive("catPaginated",function(){return{replace:!0,restrict:"E",transclude:!0,scope:{api:"=",collection:"=",facets:"=",searchRequest:"=",defaultSort:"="},templateUrl:"template/cat-paginated.tpl.html",link:function(t,e,r){if(t.api===n)throw'Attribute "api" must be set.';if(t.collection===n)throw'Attribute "collection" must be set and reference a scope property.';r.searchProps&&(t.searchProps=_.filter(r.searchProps.split(","),function(t){return!!t}))},controller:function(e,r){var i=null;i=e.searchRequest===n?new t.cat.SearchRequest(r.search()):e.searchRequest;var a=function(){e.api.list(i).then(function(t){e.count=t.totalCount,e.collection=t.elements,e.firstResult=(e.pagination.page-1)*e.pagination.size+1,e.lastResult=Math.min(e.pagination.page*e.pagination.size,e.count),e.facets!==n&&(e.facets=t.facets),e.isSinglePageList=t.totalCount<=e.pagination.size})};e.search=i.search(),e.sort=e.defaultSort?angular.copy(e.defaultSort):{property:"name",isDesc:!1},e.pagination=i.pagination(),e.count=0,e.$watch("sort",function(t){t&&(console.log("broadcasting sort changed: "+angular.toJson(t)),e.$parent.$broadcast("SortChanged",t))},!0),e.$on("SearchChanged",function(t,e){o(e)}),e.$watch("pagination",function(){i.setSearch(r),a()},!0);var o=function(t){e.search=i.search(t),i.setSearch(r),e.pagination.page=1,a()};e.$watch("search",o,!0),e.$on("SortChanged",function(t,n){e.sort=i.sort(n),i.setSearch(r),e.pagination.page=1,a()})}}})}(window,document),function(t){"use strict";angular.module("cat").directive("catSelect",function(e,n){var r=function(e){return function(n){var r=new t.cat.SearchRequest(n.data);return r.sort({property:"name",isDesc:!1}),e.list(r).then(n.success)}};return{restrict:"EA",replace:!0,priority:1,scope:{options:"=",id:"@"},link:function(t,e){e.addClass("form-control")},controller:function(t){var i=n[t.options.endpoint];return i?void(t.selectOptions=_.assign({minimumInputLength:0,adaptDropdownCssClass:function(t){return _.contains(["ng-valid","ng-invalid","ng-pristine","ng-dirty"],t)?t:null},ajax:{data:function(t){return{"search.name":t}},quietMillis:500,transport:r(i),results:function(t){return{results:t.elements}}},formatResult:function(t){return t.name},formatSelection:function(t){return t.name}},t.options["ui-select2"])):(e.error('No api endpoint "'+t.options.endpoint+'" defined'),void(t.elements=[]))},template:'<input type="text" ui-select2="selectOptions">'}})}(window,document),function(t,e,n){"use strict";angular.module("cat").directive("catSortable",function(t){return{restrict:"AC",link:function(e,r,i){var a=r.text(),o=i.catSortable||a.toLowerCase().trim();e.sort={property:n,isDesc:!1};var s="glyphicon-sort-by-attributes";i.sortMode&&("numeric"===i.sortMode?s="glyphicon-sort-by-order":"alphabet"===i.sortMode&&(s="glyphicon-sort-by-alphabet")),r.text(""),r.append(t('<a class="sort-link" href="" ng-click="toggleSort(\''+o+"')\">"+a+' <span class="glyphicon" ng-class="{\''+s+"': sort.property == '"+o+"' && !sort.isDesc, '"+s+"-alt': sort.property == '"+o+"' && sort.isDesc}\"></span></a>")(e))},controller:function(t){t.toggleSort=function(e){t.sort.property===e?t.sort.isDesc=!t.sort.isDesc:(t.sort.property=e,t.sort.isDesc=!1),t.$parent.$broadcast("SortChanged",t.sort)},t.$on("SortChanged",function(e,n){t.sort=n})}}})}(window,document),function(){"use strict";angular.module("cat").directive("numbersOnly",function(){return{require:"ngModel",link:function(t,e,n,r){r.$parsers.push(function(t){if(!t)return"";var e="[^0-9]";n.hasOwnProperty("allowFraction")&&(e="[^0-9,.]");var i=t.replace(new RegExp(e,"g"),"");return i!==t&&(r.$setViewValue(i),r.$render()),i})}}})}(window,document),function(){"use strict";angular.module("cat.service").service("$breadcrumbs",function(){var t=[];this.clear=function(){t=[]},this.set=function(e){t=e},this.get=function(){return t},this.push=function(e){t.push(e)},this.pop=function(){t.pop()},this.length=function(){return t.length},this.replaceLast=function(e){t[t.length-1]=e}})}(window,document),function(){"use strict";angular.module("cat.service").factory("errorHttpInterceptor",function(t,e,n){return{request:function(t){return n.start(),t},requestError:function(e){return n.stop(),t.reject(e)},response:function(t){return n.stop(),t},responseError:function(r){if(n.stop(),e.clearMessages("error"),r.data.error){var i="["+r.status+" - "+r.statusText+"] "+r.data.error;r.data.cause&&(i+="\n"+r.data.cause),e.addMessage("error",i)}return r.data.globalErrors&&e.addMessages("error",r.data.globalErrors),t.reject(r)}}}).config(function(t){t.interceptors.push("errorHttpInterceptor")})}(window,document),function(t,e,n){"use strict";angular.module("cat.service").factory("loadingService",function(t,e,r){var i,a=0,o=function(){a||(i=r(function(){e.spin("loading-spinner"),t.loading=!0},50)),a++},s=function(){a--,a||(i&&(r.cancel(i),i=n),e.stop("loading-spinner"),t.loading=!1)};return t.$on("$routeChangeStart",function(){o()}),t.$on("$routeChangeSuccess",function(){s()}),t.$on("$routeChangeError",function(){s()}),{start:o,stop:s}})}(window,document),function(t,e,n){"use strict";function r(t,e){this.id=t;var n=e;this.getOptions=function(){return n},this.isGroup=function(){return!1},this.isMenu=function(){return!1}}function i(t,e){this.id=t;var n=[],i=e;this.addMenuEntry=function(t,e){n.push(new r(t,e))},this.getOptions=function(){return i},this.getEntries=function(){return n},this.isGroup=function(){return!0},this.isMenu=function(){return!1}}function a(t,e){this.id=t;var n=[],a={},o=e;this.addMenuGroup=function(t,e){a[t]=new i(t,e)},this.addMenuEntry=function(t,e,i){_.isUndefined(t)?n.push(new r(e,i)):a[t].addMenuEntry(e,i)},this.getGroups=function(){return _.map(a,function(t){return t})},this.getEntries=function(t){return _.isUndefined(t)?n:a[t].getEntries()},this.getFlattened=function(){return _.flatten([n,_.map(this.getGroups(),function(t){return[t,t.getEntries()]})])},this.isMenu=function(){return!0},this.isGroup=function(){return!1},this.getOptions=function(){return o}}function o(t,e){this.id=t;var n={},r=e;this.addMenu=function(t,e){n[t]=new a(t,e)},this.addMenuGroup=function(t,e,r){n[t].addMenuGroup(e,r)},this.addMenuEntry=function(t,e,r,i){n[t].addMenuEntry(e,r,i)},this.getMenus=function(){return _.map(n,function(t){return t})},this.getOptions=function(){return r}}function s(){var t=new o("main.menu",{}),e=[],r=[],i=[];this.menu=function(t,n){e.push({menuId:t,options:n})},this.menuGroup=function(t,e,n){r.push({menuId:t,groupId:e,options:n})},this.menuEntry=function(t,e,r,a){_.isUndefined(a)&&(a=r,r=e,e=n),i.push({menuId:t,groupId:e,entryId:r,options:a})},this.$get=function(){return _.forEach(e,function(e){t.addMenu(e.menuId,e.options)}),_.forEach(r,function(e){t.addMenuGroup(e.menuId,e.groupId,e.options)}),_.forEach(i,function(e){t.addMenuEntry(e.menuId,e.groupId,e.entryId,e.options)}),t}}angular.module("cat.service").provider("$mainMenu",s)}(window,document),function(){"use strict";angular.module("cat.service").service("$globalMessages",function(t){var e={},n=this;this.getMessages=function(t){return t?e[t]:[]},this.hasMessages=function(t){return t?!!e[t]&&0!==e[t].length:!1},this.clearMessages=function(t){return t?void(e[t]=[]):void(e={})},this.addMessage=function(t,r){t&&(e[t]||n.clearMessages(t),e[t].push(r))},this.addMessages=function(t,e){t&&_.forEach(e,function(e){n.addMessage(t,e)})},this.setMessages=function(t,e){t&&(n.clearMessages(t),e&&n.addMessages(t,e))},t.$on("$routeChangeSuccess",function(){n.clearMessages()})})}(window,document);